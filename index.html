<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UniQFriends – Character Quiz</title>

  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

  <style>
    :root{
      --purple:#3a025b; --beige:#F6ebbb; --brown:#3b211a;
      --card:#ffffffcc; --ink:var(--brown); --brand:var(--purple); --brand-2:#5d0b8c;
      /* Pastel bar colors / character palettes */
      --c-uri:#a4c8ff; --c-buni:#b6f7d0; --c-marsy:#d9b79a; --c-veny:#ffc49a;
      --c-moony:#d6c6ff; --c-pluty:#ffb3d1; --c-sunny:#ffe28a;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      min-height:100vh;margin:0;color:var(--ink);line-height:1.5;overflow-x:hidden
    }

    /* ===== Animated space background (canvas) — more purple & spacey ===== */
    #space{ position:fixed; inset:0; z-index:1; background:#0b0015; display:block }

    /* FLOATING CHARACTER IMAGES (over the background) */
    .bg-decor{position:fixed;inset:0;pointer-events:none;z-index:2}
    .float{
      position:absolute;opacity:.26;filter:drop-shadow(0 24px 46px rgba(58,2,91,.35));animation:drift 30s ease-in-out infinite; border-radius:50%;
      /* Crop tighter + soften edge to reduce white halos in source images */
      clip-path:circle(44% at 50% 50%);
      -webkit-mask-image: radial-gradient(circle at 50% 50%, #000 68%, transparent 72%);
              mask-image: radial-gradient(circle at 50% 50%, #000 68%, transparent 72%);
      object-fit:cover; object-position:center; mix-blend-mode:screen;
    }
    .f1{top:-40px;left:-40px;width:240px;animation-delay:-2s}
    .f2{top:6%;right:-60px;width:280px;animation-delay:-12s}
    .f3{bottom:-50px;left:-20px;width:260px;animation-delay:-20s}
    .f4{bottom:10%;right:4%;width:260px;animation-delay:-6s}
    .f5{top:35%;left:-60px;width:220px;animation-delay:-16s}
    .f6{top:40%;right:-50px;width:220px;animation-delay:-26s}
    .f7{top:75%;left:50%;transform:translateX(-50%);width:200px;animation-delay:-8s}
    @keyframes drift{0%,100%{transform:translateY(0) rotate(0) scale(1)}50%{transform:translateY(-16px) rotate(2deg) scale(1.03)}}

    header{text-align:center;padding:24px 16px 8px;position:relative;z-index:3}
    h1{margin:0;color:#fff;font-size:32px;text-shadow:0 2px 6px rgba(0,0,0,.6)}
    p.lead{margin:6px 0 0;color:#fff;text-shadow:0 2px 6px rgba(0,0,0,.6)}

    /* Progress */
    .progress{position:sticky;top:0;z-index:4;background:rgba(58,2,91,.85);backdrop-filter:blur(6px);padding:8px 12px;color:#fff;box-shadow:0 4px 18px rgba(0,0,0,.2)}
    .progress .row{max-width:900px;margin:0 auto;display:flex;align-items:center;gap:12px}
    .meter{height:8px;background:rgba(255,255,255,.3);border-radius:999px;overflow:hidden;flex:1}
    .meter>span{display:block;height:100%;background:#F6ebbb}
    .progress .label{font-weight:600;min-width:140px}

    .wrap{max-width:900px;margin:0 auto;padding:0 16px 64px;position:relative;z-index:4}
    .card{background:var(--card);border:1px solid rgba(0,0,0,.06);border-radius:16px;padding:18px;box-shadow:0 8px 30px rgba(0,0,0,.1)}
    .stack{display:grid;gap:16px}

    .question{border:1px solid rgba(0,0,0,.06);border-radius:14px;padding:14px;background:var(--beige)}
    .question h3{margin:0 0 8px;font-size:16px;color:var(--purple)}

    /* Hover effects on answers */
    label{display:block;padding:10px 12px;border-radius:12px;cursor:pointer;background:#fff8;border:1px solid rgba(0,0,0,.05);transition:transform .18s ease,box-shadow .18s ease,background .18s ease}
    label:hover{transform:scale(1.03);box-shadow:0 6px 16px rgba(0,0,0,.15);background:#fff}
    input[type="radio"]{margin-right:8px}

    .actions{display:flex;gap:12px;margin-top:8px}
    button{flex:1;background:var(--brand);color:#fff;border:0;padding:12px 16px;border-radius:12px;font-size:16px;cursor:pointer}
    button:hover{background:var(--brand-2)}
    button.secondary{background:#efeaf7;color:var(--brand)}

    #result{margin-top:12px;background:var(--beige);border:1px solid rgba(0,0,0,0.08);border-radius:16px;padding:16px;transition: box-shadow .25s ease, background .25s ease, border-color .25s ease}
    .titleline{font-weight:700;margin-bottom:10px;color:var(--purple)}
    .rowline{display:flex;align-items:center;gap:10px;margin:8px 0}
    .name{min-width:110px;color:var(--brown)}
    .bar{height:12px;background:#eee;border-radius:999px;overflow:hidden;flex:1}
    .bar>span{display:block;height:100%}
    .pct{min-width:64px;text-align:right;font-variant-numeric:tabular-nums;color:var(--brown)}

    .winner{display:flex;align-items:center;gap:14px;margin-bottom:10px}
    .winner img{width:72px;height:72px;object-fit:cover;border-radius:50%;border:3px solid #fff;box-shadow:0 6px 18px rgba(0,0,0,.25);clip-path:circle(50% at 50% 50%)}

    /* Reveal Animations */
    .reveal{opacity:0;transform:translateY(18px);transition:opacity .5s ease, transform .5s ease}
    .reveal.show{opacity:1;transform:translateY(0)}

    /* Share/Toast */
    .share-row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#000;color:#fff;padding:10px 14px;border-radius:999px;opacity:0;pointer-events:none;transition:opacity .2s ease;z-index:9}
    .toast.show{opacity:0.9}

    /* Badge preview */
    .badge-preview{margin-top:12px;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .badge-preview img{width:160px;height:160px;border-radius:16px;box-shadow:0 6px 18px rgba(0,0,0,.15);object-fit:cover}
  </style>
</head>
<body>
  <!-- Animated Space Background -->
  <canvas id="space"></canvas>

  <!-- FLOATING CHARACTER LAYER -->
  <div class="bg-decor" id="bgDecor"></div>

  <header>
    <h1>UniQFriends – Character Quiz</h1>
    <p class="lead">Find out which UniqStar you will get!</p>
  </header>

  <!-- Progress Bar -->
  <div class="progress">
    <div class="row">
      <div class="label" id="progressLabel">Question 1 of 18</div>
      <div class="meter"><span id="progressFill" style="width:5.6%"></span></div>
    </div>
  </div>

  <main class="wrap">
    <section class="card stack" style="margin-top:16px">
      <form id="quizForm" class="stack">
        <!-- Q1 -->
        <div class="question reveal">
          <h3>Q1: What do you like most on your free day?</h3>
          <label><input type="radio" name="Q1" value="A" required> A) Going out to try new food/activities</label>
          <label><input type="radio" name="Q1" value="B"> B) Being alone, spend time at home</label>
          <label><input type="radio" name="Q1" value="C"> C) Go out, shopping/partying</label>
          <label><input type="radio" name="Q1" value="D"> D) Gaming/binge-watching</label>
        </div>

        <!-- Q2 -->
        <div class="question reveal">
          <h3>Q2: How do you deal with stress?</h3>
          <label><input type="radio" name="Q2" value="A" required> A) Singing, dancing</label>
          <label><input type="radio" name="Q2" value="B"> B) Doing something creative or eating</label>
          <label><input type="radio" name="Q2" value="C"> C) Shopping or treating yourself</label>
          <label><input type="radio" name="Q2" value="D"> D) Escaping into games or silly videos</label>
          <label><input type="radio" name="Q2" value="E"> E) Talking it out with someone close</label>
        </div>

        <!-- Q3 -->
        <div class="question reveal">
          <h3>Q3: What kind of food fits you best?</h3>
          <label><input type="radio" name="Q3" value="A" required> A) Refreshing like light meals & drinks (tea)</label>
          <label><input type="radio" name="Q3" value="B"> B) Fried or spicy food</label>
          <label><input type="radio" name="Q3" value="C"> C) Warm cozy meals like pasta, soup</label>
          <label><input type="radio" name="Q3" value="D"> D) Sweets & snacks</label>
          <label><input type="radio" name="Q3" value="E"> E) Vegan meals!</label>
        </div>

        <!-- Q4 -->
        <div class="question reveal">
          <h3>Q4: What do you find most annoying in people?</h3>
          <label><input type="radio" name="Q4" value="A" required> A) Dishonesty / fakeness</label>
          <label><input type="radio" name="Q4" value="B"> B) Close-mindedness</label>
          <label><input type="radio" name="Q4" value="C"> C) No sense of humor / too serious</label>
          <label><input type="radio" name="Q4" value="D"> D) Messy & chaotic behavior</label>
          <label><input type="radio" name="Q4" value="E"> E) Complaining without trying to change</label>
        </div>

        <!-- Q5 -->
        <div class="question reveal">
          <h3>Q5: Where do you get your energy from?</h3>
          <label><input type="radio" name="Q5" value="A" required> A) Food… duh</label>
          <label><input type="radio" name="Q5" value="B"> B) New people</label>
          <label><input type="radio" name="Q5" value="C"> C) Gaming or watching movie</label>
          <label><input type="radio" name="Q5" value="D"> D) Working</label>
          <label><input type="radio" name="Q5" value="E"> E) Listening to music/singing</label>
        </div>

        <!-- Q6 -->
        <div class="question reveal">
          <h3>Q6: What describes you the most?</h3>
          <label><input type="radio" name="Q6" value="A" required> A) Caring and kind</label>
          <label><input type="radio" name="Q6" value="B"> B) Confident, goal oriented</label>
          <label><input type="radio" name="Q6" value="C"> C) Playful, spontaneous, curious</label>
          <label><input type="radio" name="Q6" value="D"> D) Funny, chaotic, loud</label>
          <label><input type="radio" name="Q6" value="E"> E) Clever, quiet, mysterious</label>
        </div>

        <!-- Q7 -->
        <div class="question reveal">
          <h3>Q7: What’s your dream vacation?</h3>
          <label><input type="radio" name="Q7" value="A" required> A) Calm mountain or park with music</label>
          <label><input type="radio" name="Q7" value="B"> B) Explore new food & cultural trip</label>
          <label><input type="radio" name="Q7" value="C"> C) Arcade or amusement park/waterpark</label>
          <label><input type="radio" name="Q7" value="D"> D) Beach with friends & laughter</label>
          <label><input type="radio" name="Q7" value="E"> E) Stay at home</label>
        </div>

        <!-- Q8 -->
        <div class="question reveal">
          <h3>Q8: Which compliment makes you the happiest?</h3>
          <label><input type="radio" name="Q8" value="A" required> A) You’re so impressive</label>
          <label><input type="radio" name="Q8" value="B"> B) You’re hilarious</label>
          <label><input type="radio" name="Q8" value="C"> C) You’re so cute/pretty</label>
          <label><input type="radio" name="Q8" value="D"> D) You’re wise & ambitious</label>
          <label><input type="radio" name="Q8" value="E"> E) You’re so clever</label>
        </div>

        <!-- Q9 -->
        <div class="question reveal">
          <h3>Q9: If you had a superpower, what would it be?</h3>
          <label><input type="radio" name="Q9" value="A" required> A) Teleportation</label>
          <label><input type="radio" name="Q9" value="B"> B) Shapeshifting</label>
          <label><input type="radio" name="Q9" value="C"> C) Time traveling</label>
          <label><input type="radio" name="Q9" value="D"> D) Flying</label>
          <label><input type="radio" name="Q9" value="E"> E) Healing</label>
        </div>

        <!-- Q10 -->
        <div class="question reveal">
          <h3>Q10: What’s your favorite season?</h3>
          <label><input type="radio" name="Q10" value="A" required> A) Winter (chilly, cozy)</label>
          <label><input type="radio" name="Q10" value="B"> B) Autumn (productive, calm)</label>
          <label><input type="radio" name="Q10" value="C"> C) Spring (fresh, full of life)</label>
          <label><input type="radio" name="Q10" value="D"> D) Summer (wild, hot)</label>
          <label><input type="radio" name="Q10" value="E"> E) Any season</label>
        </div>

        <!-- Q11 -->
        <div class="question reveal">
          <h3>Q11: If you were in space, what would you do first?</h3>
          <label><input type="radio" name="Q11" value="A" required> A) Look out the window in awe</label>
          <label><input type="radio" name="Q11" value="B"> B) Try to float out of the ship (with a suit!)</label>
          <label><input type="radio" name="Q11" value="C"> C) Take notes and explore</label>
          <label><input type="radio" name="Q11" value="D"> D) Have fun with zero-gravity, like catching food</label>
          <label><input type="radio" name="Q11" value="E"> E) Take pictures and selfies</label>
        </div>

        <!-- Q12 -->
        <div class="question reveal">
          <h3>Q12: What’s your biggest strength?</h3>
          <label><input type="radio" name="Q12" value="A" required> A) Listening to people</label>
          <label><input type="radio" name="Q12" value="B"> B) Leadership and discipline</label>
          <label><input type="radio" name="Q12" value="C"> C) Intelligence & problem solving</label>
          <label><input type="radio" name="Q12" value="D"> D) Adaptability</label>
          <label><input type="radio" name="Q12" value="E"> E) Imagination & creation</label>
        </div>

        <!-- Q13 -->
        <div class="question reveal">
          <h3>Q13: How do you act in a (friend) group?</h3>
          <label><input type="radio" name="Q13" value="A" required> A) Quiet, observer</label>
          <label><input type="radio" name="Q13" value="B"> B) Clumsy, silly & fun</label>
          <label><input type="radio" name="Q13" value="C"> C) Leading, guiding</label>
          <label><input type="radio" name="Q13" value="D"> D) Make jokes, prank them</label>
          <label><input type="radio" name="Q13" value="E"> E) Social and loud</label>
        </div>

        <!-- Q14 -->
        <div class="question reveal">
          <h3>Q14: What’s your favorite music genre?</h3>
          <label><input type="radio" name="Q14" value="A" required> A) Rock</label>
          <label><input type="radio" name="Q14" value="B"> B) R&B / K‑Pop</label>
          <label><input type="radio" name="Q14" value="C"> C) Rap / Hip‑hop / EDM</label>
          <label><input type="radio" name="Q14" value="D"> D) Jazz / Lo‑fi / Classical / Ballad</label>
          <label><input type="radio" name="Q14" value="E"> E) Reggaeton / Upbeat</label>
        </div>

        <!-- Q15 -->
        <div class="question reveal">
          <h3>Q15: Which motto fits you best?</h3>
          <label><input type="radio" name="Q15" value="A" required> A) Better a scar from action than an ache from missed opportunity</label>
          <label><input type="radio" name="Q15" value="B"> B) The smallest spark can light the galaxy.</label>
          <label><input type="radio" name="Q15" value="C"> C) Strength grows in struggle</label>
          <label><input type="radio" name="Q15" value="D"> D) Think bigger</label>
          <label><input type="radio" name="Q15" value="E"> E) Focus on progress, not perfection</label>
        </div>

        <!-- Q16 -->
        <div class="question reveal">
          <h3>Q16: What annoys you the most when you’re home?</h3>
          <label><input type="radio" name="Q16" value="A" required> A) Any noise</label>
          <label><input type="radio" name="Q16" value="B"> B) Messiness and undone chores</label>
          <label><input type="radio" name="Q16" value="C"> C) When you don’t have anything to eat</label>
          <label><input type="radio" name="Q16" value="D"> D) People not respecting your space/privacy</label>
          <label><input type="radio" name="Q16" value="E"> E) When there is nothing fun to do</label>
        </div>

        <!-- Q17 -->
        <div class="question reveal">
          <h3>Q17: How do you approach a new challenge?</h3>
          <label><input type="radio" name="Q17" value="A" required> A) Take it slow and careful</label>
          <label><input type="radio" name="Q17" value="B"> B) Research and organise every detail</label>
          <label><input type="radio" name="Q17" value="C"> C) Just go for it and make it fun</label>
          <label><input type="radio" name="Q17" value="D"> D) Plan it and trust your gut</label>
          <label><input type="radio" name="Q17" value="E"> E) Observe others first and adapt as you go</label>
        </div>

        <!-- Q18 -->
        <div class="question reveal">
          <h3>Q18: What kind of weather do you like most?</h3>
          <label><input type="radio" name="Q18" value="A" required> A) Snow and freezing weather</label>
          <label><input type="radio" name="Q18" value="B"> B) Quiet cloudy day</label>
          <label><input type="radio" name="Q18" value="C"> C) A hot summer day</label>
          <label><input type="radio" name="Q18" value="D"> D) Sunny and windy day</label>
          <label><input type="radio" name="Q18" value="E"> E) Rainy & thunder day</label>
        </div>

        <div class="actions reveal">
          <button type="submit">See my result</button>
          <button type="button" class="secondary" id="resetBtn">Reset</button>
        </div>
      </form>

      <div id="result" class="card reveal"></div>
    </section>
  </main>

  <div class="toast" id="toast">Link copied!</div>

  <script>
    /* ===== Animated starfield (canvas) — purple galaxy look ===== */
    (function(){
      const canvas=document.getElementById('space');
      const ctx=canvas.getContext('2d');
      let w,h,pr=window.devicePixelRatio||1; const layers=[]; const L=3; let shooting=[];
      function resize(){ w=canvas.width = innerWidth*pr; h=canvas.height = innerHeight*pr; canvas.style.width=innerWidth+'px'; canvas.style.height=innerHeight+'px'; init(); }
      function rand(a,b){ return a + Math.random()*(b-a); }
      function init(){
        layers.length=0; shooting.length=0;
        for(let i=0;i<L;i++){
          const count= (i+1)*120; const speed= (i+1)*0.025; const stars=[];
          for(let s=0;s<count;s++){
            stars.push({x:Math.random()*w,y:Math.random()*h,size:rand(0.6,1.8)*(i+1),tw:Math.random()*Math.PI*2});
          }
          layers.push({speed,stars});
        }
      }
      function addShooting(){
        if(Math.random()<0.02){ // occasional
          const y=rand(0,h*0.6); shooting.push({x:-50,y, vx:rand(6,10)*pr, vy:rand(-1,1)*pr, life:rand(30,60)});
        }
      }
      function bg(){
        const g=ctx.createRadialGradient(w*0.3,h*0.3,50, w*0.5,h*0.6, Math.max(w,h));
        g.addColorStop(0,'#3a025b');
        g.addColorStop(0.4,'#1d0033');
        g.addColorStop(1,'#090013');
        ctx.fillStyle=g; ctx.fillRect(0,0,w,h);
        // subtle nebula fog
        for(let i=0;i<2;i++){
          const nx=rand(0,w), ny=rand(0,h), r=rand(h*0.2,h*0.5);
          const ng=ctx.createRadialGradient(nx,ny,0, nx,ny,r);
          ng.addColorStop(0, 'rgba(255,255,255,0.06)');
          ng.addColorStop(1, 'rgba(255,255,255,0)');
          ctx.fillStyle=ng; ctx.beginPath(); ctx.arc(nx,ny,r,0,Math.PI*2); ctx.fill();
        }
      }
      function tick(){
        bg();
        ctx.fillStyle='#ffffff';
        // parallax star layers with twinkle
        layers.forEach((layer,li)=>{
          const sp = layer.speed*pr;
          layer.stars.forEach(st=>{
            st.y += sp; if(st.y>h) st.y=0;
            const t = 0.5 + 0.5*Math.sin(st.tw += 0.02 + li*0.008);
            ctx.globalAlpha = 0.35 + 0.65*t;
            ctx.beginPath(); ctx.arc(st.x, st.y, st.size, 0, Math.PI*2); ctx.fill();
          });
        });
        ctx.globalAlpha=1;

        // shooting stars
        addShooting();
        for(let i=shooting.length-1;i>=0;i--){ const s=shooting[i]; s.x+=s.vx; s.y+=s.vy; s.life--; if(s.life<=0||s.x>w+100) shooting.splice(i,1);
          const grad=ctx.createLinearGradient(s.x-60,s.y-10, s.x,s.y);
          grad.addColorStop(0,'rgba(255,255,255,0)'); grad.addColorStop(1,'rgba(255,255,255,0.9)');
          ctx.strokeStyle=grad; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(s.x-60,s.y-10); ctx.lineTo(s.x,s.y); ctx.stroke();
        }
        requestAnimationFrame(tick);
      }
      addEventListener('resize', resize, {passive:true}); resize(); tick();
    })();

    // Characters & images
    const CHARACTERS = ["Uri","Buni","Marsy","Veny","Moony","Pluty","Sunny"];
    const IMAGE_SOURCES = {
      Pluty:["https://i.ibb.co/tphSgHQn/IMG-0607.webp"],
      Sunny:["https://i.ibb.co/G4ZcBtxX/IMG-05994.webp"],
      Moony:["https://i.ibb.co/CK248Zfr/IMG-05993.webp"],
      Uri:[  "https://i.ibb.co/Kz6HxB4Y/IMG-05995.webp"],
      Marsy:["https://i.ibb.co/cSYd4dQy/IMG-0599.webp"],
      Veny:[ "https://i.ibb.co/j0qT4cv/IMG-05991.webp"],
      Buni:[ "https://i.ibb.co/xSy5hrzR/buni.jpg"]
    };

    // Floating background characters
    const BG_ORDER = ["Pluty","Sunny","Moony","Uri","Marsy","Veny","Buni"];
    function attachImage(imgEl, sources){let i=0;function next(){if(i>=sources.length){ imgEl.remove(); return;} imgEl.src=sources[i++];} imgEl.addEventListener('error',next); next();}
    (function renderBackground(){const bg=document.getElementById('bgDecor'); bg.innerHTML=''; BG_ORDER.forEach((name,idx)=>{ const srcs=IMAGE_SOURCES[name]||[]; if(!srcs.length) return; const img=document.createElement('img'); img.alt=name; img.className=`float f${idx+1}`; attachImage(img,srcs); bg.appendChild(img); });})();

    // Scoring (updated for 18 questions)
    const POINTS={
      Q1:{A:{Buni:1,Moony:1},B:{Pluty:1},C:{Sunny:1,Veny:1},D:{Uri:1,Marsy:1}},
      Q2:{A:{Moony:1,Uri:1},B:{Buni:1},C:{Sunny:1},D:{Marsy:1,Veny:1},E:{Pluty:1}},
      Q3:{A:{Moony:1,Sunny:1},B:{Buni:1,Veny:1},C:{Pluty:1},D:{Marsy:1},E:{Uri:1}},
      Q4:{A:{Sunny:1},B:{Uri:1,Buni:1},C:{Marsy:1,Veny:1},D:{Pluty:1},E:{Moony:1}},
      Q5:{A:{Buni:1,Veny:1},B:{Sunny:1},C:{Marsy:1},D:{Pluty:1},E:{Uri:1,Moony:1}},
      Q6:{A:{Uri:1,Marsy:1},B:{Sunny:1,Moony:1},C:{Buni:1},D:{Veny:1},E:{Pluty:1}},
      Q7:{A:{Uri:1},B:{Moony:1,Buni:1},C:{Marsy:1},D:{Sunny:1,Veny:1},E:{Pluty:1}},
      Q8:{A:{Buni:1,Marsy:1},B:{Veny:1},C:{Sunny:1,Uri:1},D:{Moony:1},E:{Pluty:1}},
      Q9:{A:{Moony:1,Buni:1},B:{Marsy:1},C:{Pluty:1},D:{Veny:1,Sunny:1},E:{Uri:1}},
      Q10:{A:{Uri:1},B:{Marsy:1,Pluty:1},C:{Veny:1},D:{Sunny:1},E:{Moony:1,Buni:1}},
      Q11:{A:{Uri:1,Moony:1},B:{Marsy:1,Buni:1},C:{Pluty:1},D:{Veny:1},E:{Sunny:1}},
      Q12:{A:{Uri:1,Marsy:1},B:{Sunny:1,Moony:1},C:{Pluty:1},D:{Veny:1},E:{Buni:1}},
      Q13:{A:{Uri:1,Pluty:1},B:{Buni:1,Marsy:1},C:{Moony:1},D:{Veny:1},E:{Sunny:1}},
      Q14:{A:{Marsy:1},B:{Moony:1,Buni:1},C:{Veny:1},D:{Pluty:1,Uri:1},E:{Sunny:1}},
      Q15:{A:{Moony:1,Buni:1},B:{Uri:1},C:{Marsy:1,Veny:1},D:{Pluty:1},E:{Sunny:1}},
      Q16:{A:{Pluty:1},B:{Sunny:1,Moony:1},C:{Buni:1},D:{Marsy:1},E:{Veny:1}},
      Q17:{A:{Uri:1},B:{Pluty:1},C:{Veny:1,Buni:1},D:{Moony:1},E:{Marsy:1,Sunny:1}},
      Q18:{A:{Uri:1},B:{Pluty:1},C:{Sunny:1},D:{Veny:1,Moony:1},E:{Marsy:1,Buni:1}}
    };

    const form=document.getElementById('quizForm');
    const resultBox=document.getElementById('result');
    const resetBtn=document.getElementById('resetBtn');

    // Progress elements
    const progressLabel=document.getElementById('progressLabel');
    const progressFill=document.getElementById('progressFill');

    const COLOR={Uri:'var(--c-uri)',Buni:'var(--c-buni)',Marsy:'var(--c-marsy)',Veny:'var(--c-veny)',Moony:'var(--c-moony)',Pluty:'var(--c-pluty)',Sunny:'var(--c-sunny)'};

    /* Palettes per character for result tint & badge theme */
    const PALETTE={
      Uri:{ring:'#6aa7ff', grad:'#dfeeff', text:'#3a025b', card:'rgba(164,200,255,0.25)', border:'#6aa7ff'},
      Buni:{ring:'#46e09b', grad:'#e8fff4', text:'#3a025b', card:'rgba(182,247,208,0.25)', border:'#46e09b'},
      Marsy:{ring:'#b8875e', grad:'#f6ede5', text:'#3a025b', card:'rgba(217,183,154,0.25)', border:'#b8875e'},
      Veny:{ring:'#ff9c4c', grad:'#fff0e1', text:'#3a025b', card:'rgba(255,196,154,0.25)', border:'#ff9c4c'},
      Moony:{ring:'#a796ff', grad:'#f1edff', text:'#3a025b', card:'rgba(214,198,255,0.25)', border:'#a796ff'},
      Pluty:{ring:'#ff7fb0', grad:'#fff0f6', text:'#3a025b', card:'rgba(255,179,209,0.25)', border:'#ff7fb0'},
      Sunny:{ring:'#f2c94c', grad:'#fff7d8', text:'#3a025b', card:'rgba(255,226,138,0.25)', border:'#f2c94c'}
    };

    function computeScores(answers){
      const totals=Object.fromEntries(CHARACTERS.map(c=>[c,0]));
      for(const q in answers){const a=answers[q]; if(POINTS[q]&&POINTS[q][a]){ for(const c in POINTS[q][a]) totals[c]+=POINTS[q][a][c]; }}
      const sum=Object.values(totals).reduce((x,y)=>x+y,0);
      const pct=Object.fromEntries(CHARACTERS.map(c=>[c,sum?(totals[c]/sum)*100:0]));
      const winner=CHARACTERS.reduce((best,c)=> totals[c]>totals[best]?c:best, CHARACTERS[0]);
      return{totals,pct,winner};
    }

    function updateProgress(){
      const data=new FormData(form); let answered=0; const total=18;
      const keys=[...Array(total)].map((_,i)=>`Q${i+1}`);
      for(const q of keys) if(data.get(q)) answered++;
      const pct=(answered/total)*100; progressFill.style.width=`${Math.max(5,pct)}%`;
      progressLabel.textContent = answered<total ? `Question ${answered+1} of ${total}` : `Ready to submit`;
    }

    function showToast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1300); }

    // Reveal-on-scroll animations
    const io = new IntersectionObserver(entries=>{ entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('show'); }); },{threshold:0.12});
    document.querySelectorAll('.reveal').forEach(el=>io.observe(el));

    function renderResult({pct,winner}){
      // Winner image
      const winImg=document.createElement('img'); winImg.alt=winner; winImg.width=72; winImg.height=72; winImg.style.borderRadius='50%'; winImg.style.clipPath='circle(50% at 50% 50%)'; attachImage(winImg, IMAGE_SOURCES[winner]||[]);

      // Bars
      const bars=CHARACTERS.map(c=>{ const v=pct[c]; const w=Math.max(2,Math.min(100,v)).toFixed(1); const color=COLOR[c]||'#ddd'; return `
        <div class="rowline">
          <strong class="name">${c}</strong>
          <div class="bar"><span style="width:${w}%; background:${color}"></span></div>
          <div class="pct">${v.toFixed(1)}%</div>
        </div>`; }).join('');

      // Tint result box to winner palette + subtle glow
      const pal = PALETTE[winner] || {card:'rgba(246,235,187,0.25)', border:'#3a025b'};
      resultBox.style.background = pal.card;
      resultBox.style.borderColor = pal.border;
      resultBox.style.boxShadow = `0 10px 30px ${pal.border}55, inset 0 0 0 1px ${pal.border}33`;

      resultBox.innerHTML=''; resultBox.classList.remove('show');

      // Title row
      const head=document.createElement('div'); head.className='winner';
      const title=document.createElement('div'); title.className='titleline'; title.innerHTML=`Most likely: <strong>${winner}</strong>`;
      head.appendChild(winImg); head.appendChild(title); resultBox.appendChild(head);

      // Bars
      resultBox.insertAdjacentHTML('beforeend', bars);

      // Share row + badge row
      const shareRow=document.createElement('div'); shareRow.className='share-row';
      const shareBtn=document.createElement('button'); shareBtn.type='button'; shareBtn.textContent='Share my result';
      shareBtn.onclick=async()=>{ const url=location.href.split('#')[0]; const text=`I got ${winner} on the UniQFriends quiz! ✨`; try{ if(navigator.share){ await navigator.share({title:'My UniQStar',text,url}); } else { await navigator.clipboard.writeText(`${text} ${url}`); showToast('Link copied!'); } } catch{ await navigator.clipboard.writeText(`${text} ${url}`); showToast('Link copied!'); } };

      const badgeWrap=document.createElement('div'); badgeWrap.className='badge-preview';
      const dlBtn=document.createElement('button'); dlBtn.type='button'; dlBtn.textContent='Download badge';
      const badgeImg=document.createElement('img'); badgeImg.alt=`${winner} badge`;
      dlBtn.onclick=()=>createBadge(winner, badgeImg);

      shareRow.appendChild(shareBtn);
      badgeWrap.appendChild(dlBtn); badgeWrap.appendChild(badgeImg);
      resultBox.appendChild(shareRow); resultBox.appendChild(badgeWrap);

      setTimeout(()=>resultBox.classList.add('show'), 30);
      resultBox.scrollIntoView({behavior:'smooth',block:'start'});

      // Confetti
      confetti({particleCount:120,spread:80,origin:{y:0.6}}); setTimeout(()=>confetti({particleCount:90,spread:100,origin:{y:0.6}}),450);
    }

    /* ===== Badge generator (text above & below, readable) ===== */
    function createBadge(winner, previewImg){
      const pal = PALETTE[winner] || {ring:'#3a025b', grad:'#F6ebbb', text:'#3a025b'};
      const size = 900; const cx=size/2, cy=size/2; const canvas=document.createElement('canvas'); canvas.width=size; canvas.height=size; const ctx=canvas.getContext('2d');

      // Background gradient themed per character
      const bg = ctx.createRadialGradient(size*0.3,size*0.3,90, cx,cy,size*0.95);
      bg.addColorStop(0, '#ffffff'); bg.addColorStop(1, pal.grad); ctx.fillStyle=bg; ctx.fillRect(0,0,size,size);

      const imgRadius = size*0.30; const ringRadius = imgRadius + 18;

      // Decorative ring
      ctx.strokeStyle = pal.ring; ctx.lineWidth = 20; ctx.beginPath(); ctx.arc(cx, cy, ringRadius, 0, Math.PI*2); ctx.stroke();

      // Winner image
      const img=new Image(); img.crossOrigin='anonymous'; img.src=(IMAGE_SOURCES[winner]||[])[0]||'';
      img.onload=()=>{
        ctx.save(); ctx.beginPath(); ctx.arc(cx, cy, imgRadius, 0, Math.PI*2); ctx.clip(); ctx.drawImage(img, cx-imgRadius, cy-imgRadius, imgRadius*2, imgRadius*2); ctx.restore();

        // Text safely above & below the circle
        ctx.fillStyle = pal.text; ctx.textAlign='center';
        // Top title
        fitText(ctx, `I am ${winner}!`, 'bold', 72, 'Arial', size*0.85, cy - imgRadius - 40);
        // Bottom tagline
        fitText(ctx, 'UniQFriends ✨', 'normal', 42, 'Arial', size*0.85, cy + imgRadius + 66);

        const dataURL=canvas.toDataURL('image/png'); if(previewImg){ previewImg.src=dataURL; } const a=document.createElement('a'); a.href=dataURL; a.download=`${winner}-badge.png`; a.click();
      };
      img.onerror=()=>{
        // Monogram fallback
        ctx.fillStyle=pal.ring+'33'; ctx.beginPath(); ctx.arc(cx, cy, imgRadius, 0, Math.PI*2); ctx.fill(); ctx.fillStyle=pal.text; ctx.textAlign='center'; ctx.textBaseline='middle';
        ctx.font='bold 180px Arial'; ctx.fillText((winner||'?')[0], cx, cy+20);
        ctx.textBaseline='alphabetic';
        fitText(ctx, `I am ${winner}!`, 'bold', 72, 'Arial', size*0.85, cy - imgRadius - 40);
        fitText(ctx, 'UniQFriends ✨', 'normal', 42, 'Arial', size*0.85, cy + imgRadius + 66);
        const dataURL=canvas.toDataURL('image/png'); if(previewImg){ previewImg.src=dataURL; } const a=document.createElement('a'); a.href=dataURL; a.download=`${winner}-badge.png`; a.click();
      };

      // Fit text helper (auto scales to max width)
      function fitText(ctx, text, weight, maxSize, family, maxWidth, y){
        let size=maxSize; ctx.font=`${weight} ${size}px ${family}`; while(ctx.measureText(text).width>maxWidth && size>18){ size-=2; ctx.font=`${weight} ${size}px ${family}`; }
        ctx.fillText(text, cx, y);
      }
    }

    function handleSubmit(e){ e.preventDefault(); const data=new FormData(form); const answers={}; for(const [k,v] of data.entries()) answers[k]=v; const out=computeScores(answers); renderResult(out); }

    form.addEventListener('submit', handleSubmit);
    resetBtn.addEventListener('click', ()=>{ form.reset(); resultBox.innerHTML=''; resultBox.style.background='var(--beige)'; resultBox.style.borderColor='rgba(0,0,0,0.08)'; resultBox.style.boxShadow='0 8px 30px rgba(0,0,0,0.1)'; updateProgress(); });
    form.addEventListener('change', updateProgress);
    updateProgress();
  </script>
</body>
</html>
